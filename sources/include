# -*- mode: sh; sh-shell: bash -*-
# shellcheck disable=SC2148    # #! not appropriate for sourced script, using mode instead

collect_source_files()
{
    local -n csf_array="$1"
    shift

    # Grab directory from submitted source file value
    local bs="${BASH_SOURCE[0]}"
    local root="${bs%/*}"

    local filename
    local -a files
    if [ "$#" == 0 ]; then
        files=( "$root/"* )
    else
        files=( "$@" )
        local -i ndx limit="$#"
        for (( ndx=0; ndx<limit; ++ndx )); do
            files[$ndx]="${root}/${files[$ndx]}"
        done
    fi

    for filename in "${files[@]}"; do
        if ! [[ "$filename" =~ ^.*\.md ]] && [ "${filename##*/}" != "include" ]; then
            csf_array+=( "$filename" )
        fi
    done
}

# source files in global space to preserve contents

declare -a include_files_array
collect_source_files "include_files_array" "$@"
declare include_file
for include_file in "${include_files_array[@]}"; do
    # shellcheck disable=SC1090   # non-constant source is the point of this script
    source "$include_file"
done

# Leave the campsite as we found it
unset include_files_array include_file


